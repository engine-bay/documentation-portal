---
tags:
  - Architecture Decision Record
---

# Multiple Database Providers

## Date

18 March 2023

## What is this about?

This ADR captures some of the thinking around the choice to support multiple databases in EngineBay.

## What characteristics did we value at the time?

* We cared about making EngineBay as compatible as reasonably possible with as many tech eco-systems as possible, improving interoperability.
* Whilst we care about the performance of EngineBay, we value flexibility and compatibility more in this context.

## Considerations

* [Entity Framework](https://learn.microsoft.com/en-us/ef/core/) provides a fairly uniform experience for interacting with data, abstracting away the underlying data implementation (most of the time). With it's fairly board set of [Data Providers](https://learn.microsoft.com/en-us/ef/core/providers/?tabs=dotnet-core-cli), we could easily target many mainstream database technologies.
* [Dapr](https://docs.dapr.io/developing-applications/building-blocks/state-management/state-management-overview/) was briefly considered.
* We didn't really consider any other ORM technologies at the time
* We assumed that most developers will be familiar with some from of relational database, and most real world deployments would likely use some kind of main stream relational database technology (postgres, mysql, sqlserver etc.).
* We also assumed that likelihood of adoption would increase if database administration was with a familiar technology.
* We know that ORM generated SQL is on average worse than hand-crafted SQL in performance sensitive scenarios.

## What did we decide on?

Given the usage of .Net, we decided to lean into the usage of Entity Framework ORM to improve overall interoperability of EngineBay.

## What opportunities does this create?

* Database interoperability provides some interesting opportunities.
* We could have EngineBay running as an ephemeral service with no persistence whatsoever, using an in-memory db
* We could have EngineBay running as a light service with a simple file system based storage.
* We could have EngineBay being portable between traditional on-premise deployments and cloud native environments, e.g. Azure SQLDB or full blown managed SQL Server.
* We could have EngineBay use highly available services like CosmosDB or CockroachDB though it's compatibility layers.

## What risks did this introduce?

* Database specific performance optimizations, e.g. stored procedures, will be difficult to implement.
* We may end up performance optimizing for a *recommended* database to start with.
* We are reliant on the quality of SQL generated by the ORM.
* We won't be able to easily take advantage of specific database features.
